BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%peach%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 261485439.281889
 ALGERIA                   |   1997 | 452715155.774732
 ALGERIA                   |   1996 | 457224468.931348
 ALGERIA                   |   1995 | 452148815.614745
 ALGERIA                   |   1994 | 450828340.102544
 ALGERIA                   |   1993 | 457864707.990132
 ALGERIA                   |   1992 | 456361875.451073
 ARGENTINA                 |   1998 | 281120243.537059
 ARGENTINA                 |   1997 | 470984851.021659
 ARGENTINA                 |   1996 | 475006315.728815
 ARGENTINA                 |   1995 | 471140841.653191
 ARGENTINA                 |   1994 | 467176556.077163
 ARGENTINA                 |   1993 |   468997342.4194
 ARGENTINA                 |   1992 | 475019873.363749
 BRAZIL                    |   1998 | 269891990.549517
 BRAZIL                    |   1997 | 470021250.728965
 BRAZIL                    |   1996 | 468124953.326556
 BRAZIL                    |   1995 | 461684703.294454
 BRAZIL                    |   1994 | 466920900.082128
 BRAZIL                    |   1993 | 466411999.924565
 BRAZIL                    |   1992 | 470484663.417068
 CANADA                    |   1998 | 267343703.378985
 CANADA                    |   1997 | 467595057.267969
 CANADA                    |   1996 | 474073934.427478
 CANADA                    |   1995 | 466732805.456855
 CANADA                    |   1994 |  478102943.12242
 CANADA                    |   1993 | 465376201.198377
 CANADA                    |   1992 |  468278037.18089
 CHINA                     |   1998 |  281713362.26471
 CHINA                     |   1997 | 472799948.938109
 CHINA                     |   1996 | 474379396.019713
 CHINA                     |   1995 | 469682321.711228
 CHINA                     |   1994 | 464823997.461497
 CHINA                     |   1993 | 481909157.507438
 CHINA                     |   1992 | 474695035.232614
 EGYPT                     |   1998 | 281273181.872897
 EGYPT                     |   1997 | 473591997.776555
 EGYPT                     |   1996 | 475385586.547735
 EGYPT                     |   1995 | 466338105.313186
 EGYPT                     |   1994 | 478924529.977225
 EGYPT                     |   1993 | 469870507.079226
 EGYPT                     |   1992 | 474311773.925354
 ETHIOPIA                  |   1998 | 264801290.123348
 ETHIOPIA                  |   1997 | 447526068.351356
 ETHIOPIA                  |   1996 | 440753152.053209
 ETHIOPIA                  |   1995 | 446342271.088768
 ETHIOPIA                  |   1994 | 454937184.281388
 ETHIOPIA                  |   1993 | 449075234.601228
 ETHIOPIA                  |   1992 |  449673802.46823
 FRANCE                    |   1998 | 272211190.981259
 FRANCE                    |   1997 |  450450801.28854
 FRANCE                    |   1996 | 461017948.603908
 FRANCE                    |   1995 | 464488295.581079
 FRANCE                    |   1994 | 457577653.045395
 FRANCE                    |   1993 | 462413861.580799
 FRANCE                    |   1992 | 462608425.084265
 GERMANY                   |   1998 | 273295269.528746
 GERMANY                   |   1997 | 476770111.720636
 GERMANY                   |   1996 | 472648160.217254
 GERMANY                   |   1995 | 479089882.663149
 GERMANY                   |   1994 | 479461485.681745
 GERMANY                   |   1993 | 477353174.904344
 GERMANY                   |   1992 | 479893647.384106
 INDIA                     |   1998 |   275731964.8054
 INDIA                     |   1997 |   469283204.4375
 INDIA                     |   1996 | 476356057.160188
 INDIA                     |   1995 | 487932033.484873
 INDIA                     |   1994 |  476844618.92967
 INDIA                     |   1993 | 475534106.526358
 INDIA                     |   1992 | 480024481.776024
 INDONESIA                 |   1998 |  275633577.34014
 INDONESIA                 |   1997 | 457101251.765646
 INDONESIA                 |   1996 | 468866236.695503
 INDONESIA                 |   1995 | 474069303.041544
 INDONESIA                 |   1994 | 467258925.256096
 INDONESIA                 |   1993 | 463283412.678786
 INDONESIA                 |   1992 |  468762244.47634
 IRAN                      |   1998 | 271151873.208546
 IRAN                      |   1997 | 461706968.765989
 IRAN                      |   1996 | 467804179.342263
 IRAN                      |   1995 | 475556311.380988
 IRAN                      |   1994 | 469763679.123593
 IRAN                      |   1993 | 470313617.684491
 IRAN                      |   1992 | 479252855.763326
 IRAQ                      |   1998 | 275604294.009808
 IRAQ                      |   1997 | 468218799.677826
 IRAQ                      |   1996 | 478310129.718932
 IRAQ                      |   1995 | 469802169.675789
 IRAQ                      |   1994 | 470194082.628688
 IRAQ                      |   1993 | 468983177.919898
 IRAQ                      |   1992 | 477591369.459985
 JAPAN                     |   1998 | 264914664.857349
 JAPAN                     |   1997 |  451340736.57552
 JAPAN                     |   1996 | 465041416.441141
 JAPAN                     |   1995 | 451930124.396617
 JAPAN                     |   1994 | 459240515.101575
 JAPAN                     |   1993 | 462934386.928677
 JAPAN                     |   1992 | 449050242.788153
 JORDAN                    |   1998 | 261894243.888275
 JORDAN                    |   1997 | 463377268.082577
 JORDAN                    |   1996 | 460963922.072771
 JORDAN                    |   1995 | 452174131.131727
 JORDAN                    |   1994 | 463058684.871091
 JORDAN                    |   1993 | 451209108.454967
 JORDAN                    |   1992 |  456929232.23309
 KENYA                     |   1998 | 274710361.832563
 KENYA                     |   1997 | 463857568.951839
 KENYA                     |   1996 | 466859597.077719
 KENYA                     |   1995 | 464812055.524213
 KENYA                     |   1994 | 470056935.373289
 KENYA                     |   1993 | 470558551.853809
 KENYA                     |   1992 | 463713016.111315
 MOROCCO                   |   1998 | 271464993.368488
 MOROCCO                   |   1997 | 468829651.148566
 MOROCCO                   |   1996 | 471052454.401432
 MOROCCO                   |   1995 | 468016473.852819
 MOROCCO                   |   1994 | 465583499.687408
 MOROCCO                   |   1993 | 465202368.526763
 MOROCCO                   |   1992 | 468221155.569758
 MOZAMBIQUE                |   1998 | 265334268.241283
 MOZAMBIQUE                |   1997 | 462854259.061382
 MOZAMBIQUE                |   1996 | 461509134.904212
 MOZAMBIQUE                |   1995 | 457463861.136424
 MOZAMBIQUE                |   1994 | 461392261.950785
 MOZAMBIQUE                |   1993 |  464619784.20635
 MOZAMBIQUE                |   1992 | 453164693.469404
 PERU                      |   1998 | 279129101.547379
 PERU                      |   1997 | 464977374.886169
 PERU                      |   1996 | 457870632.889626
 PERU                      |   1995 | 458169843.890471
 PERU                      |   1994 | 460969099.500818
 PERU                      |   1993 | 460579972.157928
 PERU                      |   1992 |  462291695.25581
 ROMANIA                   |   1998 | 273744272.258106
 ROMANIA                   |   1997 | 466966752.255981
 ROMANIA                   |   1996 | 465687372.661338
 ROMANIA                   |   1995 | 460470071.637564
 ROMANIA                   |   1994 | 472836477.510482
 ROMANIA                   |   1993 | 470929745.856831
 ROMANIA                   |   1992 |  468162148.17293
 RUSSIA                    |   1998 | 269011937.502535
 RUSSIA                    |   1997 | 460676925.695055
 RUSSIA                    |   1996 | 463668195.301746
 RUSSIA                    |   1995 | 454951358.051488
 RUSSIA                    |   1994 | 465345834.661546
 RUSSIA                    |   1993 | 465416890.932347
 RUSSIA                    |   1992 | 461692015.177849
 SAUDI ARABIA              |   1998 | 275654810.638039
 SAUDI ARABIA              |   1997 |  465958804.92896
 SAUDI ARABIA              |   1996 | 468814452.767289
 SAUDI ARABIA              |   1995 | 463448767.063099
 SAUDI ARABIA              |   1994 | 464624504.216228
 SAUDI ARABIA              |   1993 | 463850904.744471
 SAUDI ARABIA              |   1992 | 472442453.976896
 UNITED KINGDOM            |   1998 | 269487365.334236
 UNITED KINGDOM            |   1997 | 457029464.659933
 UNITED KINGDOM            |   1996 | 459546962.945763
 UNITED KINGDOM            |   1995 | 447980307.340267
 UNITED KINGDOM            |   1994 | 451092621.940142
 UNITED KINGDOM            |   1993 | 466020042.276571
 UNITED KINGDOM            |   1992 | 462181624.885042
 UNITED STATES             |   1998 | 270314513.107436
 UNITED STATES             |   1997 | 459131177.898335
 UNITED STATES             |   1996 | 458953761.726786
 UNITED STATES             |   1995 | 462634194.444643
 UNITED STATES             |   1994 | 469864478.983656
 UNITED STATES             |   1993 | 469520318.207501
 UNITED STATES             |   1992 | 464891203.160167
 VIETNAM                   |   1998 | 276741875.820122
 VIETNAM                   |   1997 | 473986451.281097
 VIETNAM                   |   1996 | 474244131.896342
 VIETNAM                   |   1995 | 461268829.891492
 VIETNAM                   |   1994 |   471007719.6648
 VIETNAM                   |   1993 | 469002081.986333
 VIETNAM                   |   1992 | 478498669.231455
(175 rows)

COMMIT;
COMMIT

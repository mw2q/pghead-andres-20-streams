BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%drab%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 263870946.934996
 ALGERIA                   |   1997 | 455946914.730229
 ALGERIA                   |   1996 | 448889072.079839
 ALGERIA                   |   1995 | 456077729.551257
 ALGERIA                   |   1994 | 460745756.172734
 ALGERIA                   |   1993 | 460767823.590941
 ALGERIA                   |   1992 | 458336135.484707
 ARGENTINA                 |   1998 | 277810248.350926
 ARGENTINA                 |   1997 | 464553431.510038
 ARGENTINA                 |   1996 | 477383822.247669
 ARGENTINA                 |   1995 | 464933808.532504
 ARGENTINA                 |   1994 | 469195248.966751
 ARGENTINA                 |   1993 | 481817280.786489
 ARGENTINA                 |   1992 | 470961947.482729
 BRAZIL                    |   1998 | 274095127.712457
 BRAZIL                    |   1997 | 465375616.534756
 BRAZIL                    |   1996 | 472348405.957881
 BRAZIL                    |   1995 | 464663413.450765
 BRAZIL                    |   1994 | 467732202.387003
 BRAZIL                    |   1993 | 467988960.038672
 BRAZIL                    |   1992 | 469781913.169498
 CANADA                    |   1998 | 280908501.838008
 CANADA                    |   1997 | 479444583.006573
 CANADA                    |   1996 | 487708507.736752
 CANADA                    |   1995 | 485137744.006108
 CANADA                    |   1994 | 488336765.437902
 CANADA                    |   1993 | 478570240.808847
 CANADA                    |   1992 | 478852888.060495
 CHINA                     |   1998 | 278074313.256467
 CHINA                     |   1997 | 475621504.132656
 CHINA                     |   1996 | 476887893.599025
 CHINA                     |   1995 | 476353157.111841
 CHINA                     |   1994 | 463556656.031561
 CHINA                     |   1993 | 472289153.736709
 CHINA                     |   1992 | 474156950.502993
 EGYPT                     |   1998 | 278858856.556106
 EGYPT                     |   1997 |  469786000.65957
 EGYPT                     |   1996 | 472447211.685211
 EGYPT                     |   1995 | 476722214.903786
 EGYPT                     |   1994 | 472944880.449921
 EGYPT                     |   1993 | 473503543.506293
 EGYPT                     |   1992 | 471858718.539932
 ETHIOPIA                  |   1998 | 280683287.841524
 ETHIOPIA                  |   1997 | 470574701.279092
 ETHIOPIA                  |   1996 | 466491017.763306
 ETHIOPIA                  |   1995 | 475319109.447982
 ETHIOPIA                  |   1994 |  473803910.10144
 ETHIOPIA                  |   1993 | 474662260.838381
 ETHIOPIA                  |   1992 | 478435303.598423
 FRANCE                    |   1998 | 272569127.009026
 FRANCE                    |   1997 | 465772613.244438
 FRANCE                    |   1996 | 466824347.494667
 FRANCE                    |   1995 | 469166898.648357
 FRANCE                    |   1994 | 467346080.493154
 FRANCE                    |   1993 |  465146980.95005
 FRANCE                    |   1992 | 464566761.665711
 GERMANY                   |   1998 | 281056537.108749
 GERMANY                   |   1997 | 469779323.176119
 GERMANY                   |   1996 | 472958260.432613
 GERMANY                   |   1995 | 471659136.476704
 GERMANY                   |   1994 | 485211841.904263
 GERMANY                   |   1993 | 475932882.769109
 GERMANY                   |   1992 | 478058600.938555
 INDIA                     |   1998 | 280216938.111813
 INDIA                     |   1997 | 473209998.706882
 INDIA                     |   1996 | 479490496.640793
 INDIA                     |   1995 | 473983483.768805
 INDIA                     |   1994 | 476885540.392758
 INDIA                     |   1993 |   473799274.1939
 INDIA                     |   1992 | 480707553.675204
 INDONESIA                 |   1998 |  276163975.90354
 INDONESIA                 |   1997 | 463611138.769167
 INDONESIA                 |   1996 | 478581719.805984
 INDONESIA                 |   1995 | 475401850.924148
 INDONESIA                 |   1994 | 463415508.338189
 INDONESIA                 |   1993 | 468630819.908226
 INDONESIA                 |   1992 | 466184874.467553
 IRAN                      |   1998 | 274798913.815566
 IRAN                      |   1997 | 468877781.453937
 IRAN                      |   1996 | 471426857.719204
 IRAN                      |   1995 |  476038280.78307
 IRAN                      |   1994 |  470581560.55586
 IRAN                      |   1993 | 479260152.912666
 IRAN                      |   1992 | 478092898.710285
 IRAQ                      |   1998 | 280114286.773202
 IRAQ                      |   1997 | 469053770.097779
 IRAQ                      |   1996 | 476609600.418516
 IRAQ                      |   1995 | 478228628.827429
 IRAQ                      |   1994 |  479329128.61193
 IRAQ                      |   1993 | 479427756.054814
 IRAQ                      |   1992 | 486746473.255837
 JAPAN                     |   1998 | 271389675.541618
 JAPAN                     |   1997 | 459876476.097347
 JAPAN                     |   1996 | 468196664.099213
 JAPAN                     |   1995 | 463664383.494664
 JAPAN                     |   1994 | 467016691.965879
 JAPAN                     |   1993 | 469586756.725101
 JAPAN                     |   1992 | 464045488.052599
 JORDAN                    |   1998 | 268834020.149949
 JORDAN                    |   1997 | 461493480.298416
 JORDAN                    |   1996 | 458770242.945823
 JORDAN                    |   1995 |  454073004.29222
 JORDAN                    |   1994 | 462454243.766197
 JORDAN                    |   1993 | 455803242.586629
 JORDAN                    |   1992 | 465176061.423212
 KENYA                     |   1998 |  271195899.22962
 KENYA                     |   1997 | 466514665.511153
 KENYA                     |   1996 | 474186042.619575
 KENYA                     |   1995 | 468105929.255141
 KENYA                     |   1994 | 471620118.018458
 KENYA                     |   1993 | 462232175.067025
 KENYA                     |   1992 | 472379633.953437
 MOROCCO                   |   1998 | 276951015.889484
 MOROCCO                   |   1997 | 479975318.291926
 MOROCCO                   |   1996 | 471821036.061655
 MOROCCO                   |   1995 | 477736378.624257
 MOROCCO                   |   1994 | 468027345.973805
 MOROCCO                   |   1993 | 469389962.096074
 MOROCCO                   |   1992 | 480381261.179099
 MOZAMBIQUE                |   1998 | 270941026.928042
 MOZAMBIQUE                |   1997 | 461060622.987236
 MOZAMBIQUE                |   1996 |  462828391.33327
 MOZAMBIQUE                |   1995 | 463804879.927171
 MOZAMBIQUE                |   1994 | 478835105.531031
 MOZAMBIQUE                |   1993 | 466627709.566051
 MOZAMBIQUE                |   1992 | 462303818.819742
 PERU                      |   1998 | 275699305.598028
 PERU                      |   1997 | 472537875.502431
 PERU                      |   1996 | 464979222.120538
 PERU                      |   1995 | 471950197.008445
 PERU                      |   1994 | 471439073.269869
 PERU                      |   1993 | 467260904.160564
 PERU                      |   1992 | 470263245.462309
 ROMANIA                   |   1998 | 269761065.500276
 ROMANIA                   |   1997 | 463317850.987033
 ROMANIA                   |   1996 | 469212540.124493
 ROMANIA                   |   1995 |  463123632.87953
 ROMANIA                   |   1994 | 468008396.570074
 ROMANIA                   |   1993 | 458766750.603763
 ROMANIA                   |   1992 | 467677482.944834
 RUSSIA                    |   1998 | 280691284.038174
 RUSSIA                    |   1997 | 475887915.198604
 RUSSIA                    |   1996 |   474300395.7958
 RUSSIA                    |   1995 | 468593247.752384
 RUSSIA                    |   1994 |    468715167.753
 RUSSIA                    |   1993 | 463339348.604628
 RUSSIA                    |   1992 | 467219510.219683
 SAUDI ARABIA              |   1998 |  281455734.72365
 SAUDI ARABIA              |   1997 | 470713445.845722
 SAUDI ARABIA              |   1996 | 468570847.215639
 SAUDI ARABIA              |   1995 | 472267247.849026
 SAUDI ARABIA              |   1994 | 465133432.147177
 SAUDI ARABIA              |   1993 | 469602822.677899
 SAUDI ARABIA              |   1992 | 470095846.029236
 UNITED KINGDOM            |   1998 | 276220333.770593
 UNITED KINGDOM            |   1997 | 462262658.479335
 UNITED KINGDOM            |   1996 | 464173905.431243
 UNITED KINGDOM            |   1995 | 464305739.420584
 UNITED KINGDOM            |   1994 |  469522681.94445
 UNITED KINGDOM            |   1993 | 465321615.966373
 UNITED KINGDOM            |   1992 | 467035132.834934
 UNITED STATES             |   1998 | 277591042.838236
 UNITED STATES             |   1997 | 471298713.806409
 UNITED STATES             |   1996 | 473762704.624265
 UNITED STATES             |   1995 | 465729376.289815
 UNITED STATES             |   1994 | 465677149.271832
 UNITED STATES             |   1993 | 469972299.793493
 UNITED STATES             |   1992 | 477410043.467834
 VIETNAM                   |   1998 |  274993510.72625
 VIETNAM                   |   1997 | 464205184.016788
 VIETNAM                   |   1996 | 464558667.700006
 VIETNAM                   |   1995 | 463558950.274861
 VIETNAM                   |   1994 | 464448406.782671
 VIETNAM                   |   1993 | 457005920.553556
 VIETNAM                   |   1992 | 463182769.278564
(175 rows)

COMMIT;
COMMIT

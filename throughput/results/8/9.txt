BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%metallic%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 269212817.909284
 ALGERIA                   |   1997 | 462948425.736747
 ALGERIA                   |   1996 | 456716637.392862
 ALGERIA                   |   1995 | 463300789.774029
 ALGERIA                   |   1994 | 460277532.016329
 ALGERIA                   |   1993 | 461072022.856206
 ALGERIA                   |   1992 | 454585737.606624
 ARGENTINA                 |   1998 | 275588459.564091
 ARGENTINA                 |   1997 | 469999920.407638
 ARGENTINA                 |   1996 | 465914024.031829
 ARGENTINA                 |   1995 | 463902531.597998
 ARGENTINA                 |   1994 | 468193190.631185
 ARGENTINA                 |   1993 | 469913962.256039
 ARGENTINA                 |   1992 | 457918312.039221
 BRAZIL                    |   1998 | 271084062.934516
 BRAZIL                    |   1997 | 457883345.546189
 BRAZIL                    |   1996 | 463500458.320438
 BRAZIL                    |   1995 | 455929191.108171
 BRAZIL                    |   1994 | 461139183.801894
 BRAZIL                    |   1993 | 465861747.563852
 BRAZIL                    |   1992 | 470635972.686816
 CANADA                    |   1998 | 278984561.725067
 CANADA                    |   1997 | 471866182.981588
 CANADA                    |   1996 | 477750161.315471
 CANADA                    |   1995 | 474761944.016705
 CANADA                    |   1994 | 479417265.518544
 CANADA                    |   1993 | 464805676.716118
 CANADA                    |   1992 | 467923967.839872
 CHINA                     |   1998 | 270886824.995547
 CHINA                     |   1997 | 465000822.411769
 CHINA                     |   1996 | 466209296.831053
 CHINA                     |   1995 | 457341528.937832
 CHINA                     |   1994 |   453635668.6606
 CHINA                     |   1993 | 459499517.466105
 CHINA                     |   1992 | 465121426.694868
 EGYPT                     |   1998 | 278460485.475189
 EGYPT                     |   1997 | 473947086.748155
 EGYPT                     |   1996 | 471667488.287843
 EGYPT                     |   1995 | 472564385.106075
 EGYPT                     |   1994 | 479248977.385763
 EGYPT                     |   1993 | 470510549.392102
 EGYPT                     |   1992 | 476056512.428235
 ETHIOPIA                  |   1998 | 263046105.381898
 ETHIOPIA                  |   1997 | 464854247.304238
 ETHIOPIA                  |   1996 | 457392532.892513
 ETHIOPIA                  |   1995 | 447998905.792301
 ETHIOPIA                  |   1994 | 453831023.485146
 ETHIOPIA                  |   1993 | 455712391.128008
 ETHIOPIA                  |   1992 | 455622512.400894
 FRANCE                    |   1998 | 267781429.014082
 FRANCE                    |   1997 | 464806318.546927
 FRANCE                    |   1996 | 471855750.617003
 FRANCE                    |   1995 | 463334707.660322
 FRANCE                    |   1994 | 465842322.222258
 FRANCE                    |   1993 | 460753234.353226
 FRANCE                    |   1992 | 467189098.415937
 GERMANY                   |   1998 | 278123436.198259
 GERMANY                   |   1997 | 473948848.704167
 GERMANY                   |   1996 | 476289260.381522
 GERMANY                   |   1995 | 474664854.693992
 GERMANY                   |   1994 |  473555789.18047
 GERMANY                   |   1993 | 474250100.651907
 GERMANY                   |   1992 | 473990896.966468
 INDIA                     |   1998 | 274754795.570858
 INDIA                     |   1997 | 472532490.045386
 INDIA                     |   1996 | 472197741.550541
 INDIA                     |   1995 | 459512192.866391
 INDIA                     |   1994 | 465179561.761013
 INDIA                     |   1993 | 474794076.945079
 INDIA                     |   1992 | 474168182.291997
 INDONESIA                 |   1998 | 267862026.763569
 INDONESIA                 |   1997 | 457267595.029691
 INDONESIA                 |   1996 | 459445990.784395
 INDONESIA                 |   1995 | 452059799.147569
 INDONESIA                 |   1994 | 465610673.159214
 INDONESIA                 |   1993 | 456298044.317935
 INDONESIA                 |   1992 | 458038612.011654
 IRAN                      |   1998 |  272345854.33886
 IRAN                      |   1997 | 466006877.293044
 IRAN                      |   1996 | 472302517.958755
 IRAN                      |   1995 | 467432257.974186
 IRAN                      |   1994 | 465590561.476245
 IRAN                      |   1993 | 465063628.868569
 IRAN                      |   1992 | 464230352.080112
 IRAQ                      |   1998 | 271922976.342782
 IRAQ                      |   1997 |  467536188.31722
 IRAQ                      |   1996 | 469666192.777311
 IRAQ                      |   1995 |  471377714.75777
 IRAQ                      |   1994 | 472379659.121146
 IRAQ                      |   1993 | 471904003.507609
 IRAQ                      |   1992 | 473634416.861455
 JAPAN                     |   1998 | 272226000.340969
 JAPAN                     |   1997 | 465084812.795206
 JAPAN                     |   1996 | 463946458.582199
 JAPAN                     |   1995 | 464623648.056309
 JAPAN                     |   1994 | 459599897.804015
 JAPAN                     |   1993 | 466757954.464214
 JAPAN                     |   1992 | 462495290.689273
 JORDAN                    |   1998 | 270093409.441927
 JORDAN                    |   1997 | 455564484.177858
 JORDAN                    |   1996 | 456926447.804994
 JORDAN                    |   1995 | 464964105.745006
 JORDAN                    |   1994 | 458066032.293464
 JORDAN                    |   1993 | 456124293.289703
 JORDAN                    |   1992 | 457859429.209337
 KENYA                     |   1998 | 274575794.679807
 KENYA                     |   1997 | 469137984.537025
 KENYA                     |   1996 | 467236594.291986
 KENYA                     |   1995 | 468762529.256371
 KENYA                     |   1994 | 467261581.223163
 KENYA                     |   1993 | 469310451.639721
 KENYA                     |   1992 | 473254980.522944
 MOROCCO                   |   1998 | 274230095.609799
 MOROCCO                   |   1997 | 464492140.153464
 MOROCCO                   |   1996 | 461619030.544364
 MOROCCO                   |   1995 | 462251422.333282
 MOROCCO                   |   1994 | 466446437.452964
 MOROCCO                   |   1993 | 460814727.762286
 MOROCCO                   |   1992 | 459826451.043755
 MOZAMBIQUE                |   1998 | 271328627.278439
 MOZAMBIQUE                |   1997 | 467649283.057829
 MOZAMBIQUE                |   1996 | 469293338.923506
 MOZAMBIQUE                |   1995 | 472138545.493593
 MOZAMBIQUE                |   1994 | 463279446.573311
 MOZAMBIQUE                |   1993 | 464356119.206408
 MOZAMBIQUE                |   1992 | 466076407.664173
 PERU                      |   1998 | 263747731.473696
 PERU                      |   1997 | 458282546.225213
 PERU                      |   1996 | 469715016.298003
 PERU                      |   1995 | 462900811.638331
 PERU                      |   1994 |  453523994.42144
 PERU                      |   1993 |  459617139.20581
 PERU                      |   1992 | 459188217.080517
 ROMANIA                   |   1998 | 280863495.756418
 ROMANIA                   |   1997 |  469864441.51618
 ROMANIA                   |   1996 | 467630854.487302
 ROMANIA                   |   1995 | 461205504.494896
 ROMANIA                   |   1994 | 476873241.345244
 ROMANIA                   |   1993 | 468289335.279749
 ROMANIA                   |   1992 | 474584247.548711
 RUSSIA                    |   1998 | 281080223.191393
 RUSSIA                    |   1997 | 473740743.264428
 RUSSIA                    |   1996 |   476117414.0305
 RUSSIA                    |   1995 | 469446029.388413
 RUSSIA                    |   1994 | 480358284.331216
 RUSSIA                    |   1993 | 469710883.351557
 RUSSIA                    |   1992 | 468734247.639803
 SAUDI ARABIA              |   1998 | 275144760.993018
 SAUDI ARABIA              |   1997 | 468685031.628309
 SAUDI ARABIA              |   1996 | 472335278.246918
 SAUDI ARABIA              |   1995 | 469104218.671799
 SAUDI ARABIA              |   1994 |  460944709.50085
 SAUDI ARABIA              |   1993 | 466859633.367658
 SAUDI ARABIA              |   1992 | 466377759.329796
 UNITED KINGDOM            |   1998 | 271564473.898406
 UNITED KINGDOM            |   1997 | 461871543.010858
 UNITED KINGDOM            |   1996 | 466951097.538919
 UNITED KINGDOM            |   1995 | 464175566.503969
 UNITED KINGDOM            |   1994 | 459061421.450336
 UNITED KINGDOM            |   1993 |  463453637.37234
 UNITED KINGDOM            |   1992 | 457750935.059535
 UNITED STATES             |   1998 | 266036192.599007
 UNITED STATES             |   1997 | 465450630.405126
 UNITED STATES             |   1996 | 465628995.538491
 UNITED STATES             |   1995 | 468155254.706306
 UNITED STATES             |   1994 | 471831573.175555
 UNITED STATES             |   1993 | 466529779.521924
 UNITED STATES             |   1992 | 461935842.043971
 VIETNAM                   |   1998 | 270356304.947752
 VIETNAM                   |   1997 | 459123706.371931
 VIETNAM                   |   1996 | 466235084.072685
 VIETNAM                   |   1995 |  458829548.31464
 VIETNAM                   |   1994 |  469330456.70762
 VIETNAM                   |   1993 | 470117465.385145
 VIETNAM                   |   1992 | 462518067.259873
(175 rows)

COMMIT;
COMMIT

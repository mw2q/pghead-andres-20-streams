BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%sandy%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 271604370.036452
 ALGERIA                   |   1997 | 452850161.393593
 ALGERIA                   |   1996 | 456744143.881871
 ALGERIA                   |   1995 | 464844321.326903
 ALGERIA                   |   1994 | 451682178.443948
 ALGERIA                   |   1993 | 461283969.161212
 ALGERIA                   |   1992 | 459904084.426159
 ARGENTINA                 |   1998 | 270594133.066576
 ARGENTINA                 |   1997 | 466223283.066446
 ARGENTINA                 |   1996 | 463459665.659923
 ARGENTINA                 |   1995 | 461351371.040969
 ARGENTINA                 |   1994 | 467946111.070584
 ARGENTINA                 |   1993 | 464593005.671801
 ARGENTINA                 |   1992 | 465201065.316037
 BRAZIL                    |   1998 | 275572138.884959
 BRAZIL                    |   1997 | 473107108.318922
 BRAZIL                    |   1996 | 462028491.885443
 BRAZIL                    |   1995 | 464464415.516489
 BRAZIL                    |   1994 | 467957981.932377
 BRAZIL                    |   1993 | 468326445.608723
 BRAZIL                    |   1992 | 471527208.235989
 CANADA                    |   1998 |  278373783.53041
 CANADA                    |   1997 |  483213979.81808
 CANADA                    |   1996 | 479040692.098127
 CANADA                    |   1995 | 486530746.993684
 CANADA                    |   1994 | 489887655.313804
 CANADA                    |   1993 |  480211529.95862
 CANADA                    |   1992 | 480103265.944589
 CHINA                     |   1998 | 274394782.513305
 CHINA                     |   1997 | 463137966.331162
 CHINA                     |   1996 | 461318576.213975
 CHINA                     |   1995 | 468532723.435676
 CHINA                     |   1994 | 465514351.700032
 CHINA                     |   1993 | 465294244.239956
 CHINA                     |   1992 | 465546539.400862
 EGYPT                     |   1998 | 269891531.690831
 EGYPT                     |   1997 | 461404416.366342
 EGYPT                     |   1996 | 464871177.473594
 EGYPT                     |   1995 | 471495987.727791
 EGYPT                     |   1994 | 462692475.629434
 EGYPT                     |   1993 | 469681390.018831
 EGYPT                     |   1992 | 471247954.374452
 ETHIOPIA                  |   1998 | 266379078.532076
 ETHIOPIA                  |   1997 | 457042801.824135
 ETHIOPIA                  |   1996 |  455120179.77078
 ETHIOPIA                  |   1995 | 456804722.097351
 ETHIOPIA                  |   1994 | 457377887.912306
 ETHIOPIA                  |   1993 |   456479012.1488
 ETHIOPIA                  |   1992 | 470373893.267719
 FRANCE                    |   1998 | 275426453.943405
 FRANCE                    |   1997 | 465563131.804649
 FRANCE                    |   1996 | 466095024.006152
 FRANCE                    |   1995 | 473801937.031515
 FRANCE                    |   1994 | 462928950.099899
 FRANCE                    |   1993 |  460860702.36058
 FRANCE                    |   1992 | 460544496.023323
 GERMANY                   |   1998 | 274829380.426951
 GERMANY                   |   1997 | 480549825.742186
 GERMANY                   |   1996 |  478108915.37201
 GERMANY                   |   1995 |  472354485.86398
 GERMANY                   |   1994 |  471349106.18632
 GERMANY                   |   1993 | 479575974.202515
 GERMANY                   |   1992 | 475018348.015038
 INDIA                     |   1998 |  284514491.26959
 INDIA                     |   1997 | 478544243.839497
 INDIA                     |   1996 | 472642107.045654
 INDIA                     |   1995 | 474363145.198262
 INDIA                     |   1994 | 479997170.737971
 INDIA                     |   1993 | 477586795.987096
 INDIA                     |   1992 | 475310546.984568
 INDONESIA                 |   1998 | 267681580.242672
 INDONESIA                 |   1997 | 455345909.219477
 INDONESIA                 |   1996 | 459110041.428709
 INDONESIA                 |   1995 | 449702228.247591
 INDONESIA                 |   1994 | 458822450.544027
 INDONESIA                 |   1993 | 450750511.194383
 INDONESIA                 |   1992 | 453077338.190276
 IRAN                      |   1998 | 270927030.560753
 IRAN                      |   1997 | 468135792.315936
 IRAN                      |   1996 | 471807308.480698
 IRAN                      |   1995 | 464118458.140796
 IRAN                      |   1994 | 472809979.516405
 IRAN                      |   1993 | 466056882.050801
 IRAN                      |   1992 | 467284572.670337
 IRAQ                      |   1998 | 275735746.924541
 IRAQ                      |   1997 | 472425170.727866
 IRAQ                      |   1996 | 472826036.885507
 IRAQ                      |   1995 | 479393632.946271
 IRAQ                      |   1994 | 472727276.515103
 IRAQ                      |   1993 | 471515680.572994
 IRAQ                      |   1992 | 474146865.738911
 JAPAN                     |   1998 | 271654275.568647
 JAPAN                     |   1997 |  463841666.73963
 JAPAN                     |   1996 | 463950056.075722
 JAPAN                     |   1995 | 469405798.887828
 JAPAN                     |   1994 | 465701354.533921
 JAPAN                     |   1993 | 463533878.978766
 JAPAN                     |   1992 | 469890357.528589
 JORDAN                    |   1998 | 264081842.293333
 JORDAN                    |   1997 | 453232682.977702
 JORDAN                    |   1996 | 456663414.150313
 JORDAN                    |   1995 | 453492624.919785
 JORDAN                    |   1994 | 458986603.052892
 JORDAN                    |   1993 | 464585975.507869
 JORDAN                    |   1992 |  460440972.30853
 KENYA                     |   1998 | 273187311.563444
 KENYA                     |   1997 | 468209244.497836
 KENYA                     |   1996 | 469531550.982481
 KENYA                     |   1995 | 469125537.468508
 KENYA                     |   1994 | 470570324.357276
 KENYA                     |   1993 | 467307610.726298
 KENYA                     |   1992 | 468073603.632027
 MOROCCO                   |   1998 | 277595156.745597
 MOROCCO                   |   1997 | 472907585.395178
 MOROCCO                   |   1996 | 469063081.484108
 MOROCCO                   |   1995 | 472265213.614137
 MOROCCO                   |   1994 | 473799438.695374
 MOROCCO                   |   1993 | 468023756.318373
 MOROCCO                   |   1992 | 461457276.995502
 MOZAMBIQUE                |   1998 | 272606879.730124
 MOZAMBIQUE                |   1997 | 451799878.375839
 MOZAMBIQUE                |   1996 | 452048787.464714
 MOZAMBIQUE                |   1995 | 454217148.557557
 MOZAMBIQUE                |   1994 | 458669670.921928
 MOZAMBIQUE                |   1993 | 450548071.803082
 MOZAMBIQUE                |   1992 | 452371222.634853
 PERU                      |   1998 | 266506298.887362
 PERU                      |   1997 | 454962087.560639
 PERU                      |   1996 | 461394903.767095
 PERU                      |   1995 | 462797132.536478
 PERU                      |   1994 | 470450653.178735
 PERU                      |   1993 | 457491174.448327
 PERU                      |   1992 | 466336210.148219
 ROMANIA                   |   1998 |  271777519.58331
 ROMANIA                   |   1997 | 460448349.836097
 ROMANIA                   |   1996 | 461821109.551077
 ROMANIA                   |   1995 | 462137963.133243
 ROMANIA                   |   1994 | 457998244.202607
 ROMANIA                   |   1993 | 455800789.030499
 ROMANIA                   |   1992 | 470897872.083879
 RUSSIA                    |   1998 | 270809147.352904
 RUSSIA                    |   1997 | 468076473.516079
 RUSSIA                    |   1996 | 488911982.553899
 RUSSIA                    |   1995 | 474081199.253872
 RUSSIA                    |   1994 | 477997602.110428
 RUSSIA                    |   1993 | 474063479.932369
 RUSSIA                    |   1992 | 479095505.922518
 SAUDI ARABIA              |   1998 |  274612168.85188
 SAUDI ARABIA              |   1997 | 471514889.160833
 SAUDI ARABIA              |   1996 | 468868919.785332
 SAUDI ARABIA              |   1995 | 468349363.140397
 SAUDI ARABIA              |   1994 | 464068592.811493
 SAUDI ARABIA              |   1993 |  467646941.20802
 SAUDI ARABIA              |   1992 | 472111960.243366
 UNITED KINGDOM            |   1998 | 274834129.435993
 UNITED KINGDOM            |   1997 | 471515218.105186
 UNITED KINGDOM            |   1996 | 473425870.992526
 UNITED KINGDOM            |   1995 | 464190478.412366
 UNITED KINGDOM            |   1994 | 470032954.138623
 UNITED KINGDOM            |   1993 | 468659552.602797
 UNITED KINGDOM            |   1992 | 470636488.805665
 UNITED STATES             |   1998 | 276734634.942437
 UNITED STATES             |   1997 | 472694108.205938
 UNITED STATES             |   1996 | 478759536.618802
 UNITED STATES             |   1995 | 473423513.398715
 UNITED STATES             |   1994 | 477463215.605719
 UNITED STATES             |   1993 | 479207937.565136
 UNITED STATES             |   1992 |   471661011.4223
 VIETNAM                   |   1998 | 269565140.674671
 VIETNAM                   |   1997 | 454937387.653359
 VIETNAM                   |   1996 | 464689094.677485
 VIETNAM                   |   1995 | 458030805.909449
 VIETNAM                   |   1994 | 456656161.737337
 VIETNAM                   |   1993 | 461476799.306331
 VIETNAM                   |   1992 | 458667542.565318
(175 rows)

COMMIT;
COMMIT

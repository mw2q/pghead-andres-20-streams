BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%almond%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268053439.642611
 ALGERIA                   |   1997 | 452943275.072012
 ALGERIA                   |   1996 | 456919730.835181
 ALGERIA                   |   1995 | 459665091.692736
 ALGERIA                   |   1994 | 449491414.244634
 ALGERIA                   |   1993 | 459925042.494012
 ALGERIA                   |   1992 | 451545813.779734
 ARGENTINA                 |   1998 | 274964233.993714
 ARGENTINA                 |   1997 | 471256503.075611
 ARGENTINA                 |   1996 | 473293020.435805
 ARGENTINA                 |   1995 | 466462186.973296
 ARGENTINA                 |   1994 | 472220619.233184
 ARGENTINA                 |   1993 | 475778472.013044
 ARGENTINA                 |   1992 | 473730677.011087
 BRAZIL                    |   1998 | 272804272.537833
 BRAZIL                    |   1997 |  466626926.17752
 BRAZIL                    |   1996 | 451785558.519186
 BRAZIL                    |   1995 | 461242488.918284
 BRAZIL                    |   1994 | 461120208.319216
 BRAZIL                    |   1993 | 458223029.783138
 BRAZIL                    |   1992 | 463432672.756183
 CANADA                    |   1998 | 285254034.535779
 CANADA                    |   1997 | 484400697.412511
 CANADA                    |   1996 | 473215792.674238
 CANADA                    |   1995 | 469352279.075796
 CANADA                    |   1994 | 473853737.022109
 CANADA                    |   1993 | 475105064.188417
 CANADA                    |   1992 | 473847703.508118
 CHINA                     |   1998 | 273448888.178686
 CHINA                     |   1997 | 449321091.956172
 CHINA                     |   1996 | 453699155.459099
 CHINA                     |   1995 | 462922525.515768
 CHINA                     |   1994 |  458734641.84453
 CHINA                     |   1993 | 463212994.712461
 CHINA                     |   1992 | 463382283.387598
 EGYPT                     |   1998 | 271582183.698963
 EGYPT                     |   1997 | 463892144.654428
 EGYPT                     |   1996 | 465958443.817882
 EGYPT                     |   1995 | 469382515.408401
 EGYPT                     |   1994 | 466703942.743862
 EGYPT                     |   1993 | 458892407.852208
 EGYPT                     |   1992 | 462660702.251306
 ETHIOPIA                  |   1998 |  266887974.96314
 ETHIOPIA                  |   1997 |  457594765.42102
 ETHIOPIA                  |   1996 | 455228598.821957
 ETHIOPIA                  |   1995 |  454444264.33047
 ETHIOPIA                  |   1994 | 459576038.258189
 ETHIOPIA                  |   1993 | 463173151.528022
 ETHIOPIA                  |   1992 | 458996384.225094
 FRANCE                    |   1998 | 270299022.139667
 FRANCE                    |   1997 | 452169902.837342
 FRANCE                    |   1996 | 458192376.326856
 FRANCE                    |   1995 | 453414244.436329
 FRANCE                    |   1994 | 454462856.610846
 FRANCE                    |   1993 | 450792216.990734
 FRANCE                    |   1992 | 453272641.911815
 GERMANY                   |   1998 | 278499482.130515
 GERMANY                   |   1997 | 494149606.916866
 GERMANY                   |   1996 | 484167785.960117
 GERMANY                   |   1995 | 481308076.622188
 GERMANY                   |   1994 | 480595856.895439
 GERMANY                   |   1993 | 482263272.935962
 GERMANY                   |   1992 | 481157050.525656
 INDIA                     |   1998 | 271910246.213407
 INDIA                     |   1997 | 473307050.001697
 INDIA                     |   1996 | 472929712.457673
 INDIA                     |   1995 | 465014534.149966
 INDIA                     |   1994 | 472747269.908256
 INDIA                     |   1993 | 472817130.872399
 INDIA                     |   1992 | 466310056.485058
 INDONESIA                 |   1998 | 266282424.947234
 INDONESIA                 |   1997 | 461568632.592403
 INDONESIA                 |   1996 | 458775275.897179
 INDONESIA                 |   1995 | 463131397.693801
 INDONESIA                 |   1994 | 456189343.163876
 INDONESIA                 |   1993 | 462932157.368893
 INDONESIA                 |   1992 | 469364677.948191
 IRAN                      |   1998 | 270279274.861308
 IRAN                      |   1997 | 468293209.309954
 IRAN                      |   1996 | 467253788.710947
 IRAN                      |   1995 | 467560183.383859
 IRAN                      |   1994 | 468891118.301245
 IRAN                      |   1993 |  466074493.19095
 IRAN                      |   1992 | 468642535.581206
 IRAQ                      |   1998 | 274364953.767619
 IRAQ                      |   1997 | 478765233.546901
 IRAQ                      |   1996 | 469918064.850775
 IRAQ                      |   1995 | 472330816.662993
 IRAQ                      |   1994 | 475390390.201832
 IRAQ                      |   1993 |  476959340.94049
 IRAQ                      |   1992 | 471552989.219436
 JAPAN                     |   1998 |  269836203.58927
 JAPAN                     |   1997 | 468746614.219966
 JAPAN                     |   1996 | 461952137.248108
 JAPAN                     |   1995 | 465808939.056216
 JAPAN                     |   1994 | 463490471.754205
 JAPAN                     |   1993 |   461996028.3708
 JAPAN                     |   1992 |  464557501.69853
 JORDAN                    |   1998 | 273814124.998739
 JORDAN                    |   1997 | 462937766.842909
 JORDAN                    |   1996 | 460850122.481873
 JORDAN                    |   1995 | 465408813.655872
 JORDAN                    |   1994 | 462736112.520331
 JORDAN                    |   1993 | 465956364.767317
 JORDAN                    |   1992 | 452889714.296552
 KENYA                     |   1998 | 270451786.630906
 KENYA                     |   1997 | 465554428.358543
 KENYA                     |   1996 | 470895578.580784
 KENYA                     |   1995 | 462347461.131624
 KENYA                     |   1994 | 464245567.044161
 KENYA                     |   1993 | 463766613.853533
 KENYA                     |   1992 | 472227445.691021
 MOROCCO                   |   1998 | 271148748.450092
 MOROCCO                   |   1997 | 471090749.501604
 MOROCCO                   |   1996 |   467036315.7778
 MOROCCO                   |   1995 | 468800805.511338
 MOROCCO                   |   1994 | 460380911.183843
 MOROCCO                   |   1993 | 465628589.354257
 MOROCCO                   |   1992 | 471572087.632066
 MOZAMBIQUE                |   1998 | 265031039.367868
 MOZAMBIQUE                |   1997 | 457060155.797252
 MOZAMBIQUE                |   1996 | 447620919.952307
 MOZAMBIQUE                |   1995 | 464397734.275184
 MOZAMBIQUE                |   1994 |  454539205.58966
 MOZAMBIQUE                |   1993 | 455300195.083354
 MOZAMBIQUE                |   1992 | 452414095.384547
 PERU                      |   1998 | 280631376.721481
 PERU                      |   1997 | 463222049.044723
 PERU                      |   1996 | 474155418.631093
 PERU                      |   1995 | 476223855.200026
 PERU                      |   1994 | 464872561.091712
 PERU                      |   1993 | 467929084.517087
 PERU                      |   1992 | 483832457.152644
 ROMANIA                   |   1998 | 272403841.958463
 ROMANIA                   |   1997 | 468453211.684387
 ROMANIA                   |   1996 | 471759770.751862
 ROMANIA                   |   1995 | 460233109.554392
 ROMANIA                   |   1994 | 468528683.826769
 ROMANIA                   |   1993 | 469891070.683122
 ROMANIA                   |   1992 | 470070072.159587
 RUSSIA                    |   1998 | 270801052.239557
 RUSSIA                    |   1997 | 465387710.422404
 RUSSIA                    |   1996 | 466643250.583855
 RUSSIA                    |   1995 | 463262632.765858
 RUSSIA                    |   1994 |  466176242.20914
 RUSSIA                    |   1993 | 464460703.076918
 RUSSIA                    |   1992 | 467927215.203646
 SAUDI ARABIA              |   1998 | 271626818.024188
 SAUDI ARABIA              |   1997 |  471965410.97836
 SAUDI ARABIA              |   1996 | 467273750.837153
 SAUDI ARABIA              |   1995 | 471581177.516306
 SAUDI ARABIA              |   1994 |  473479302.81737
 SAUDI ARABIA              |   1993 | 477305496.810997
 SAUDI ARABIA              |   1992 | 473561922.515287
 UNITED KINGDOM            |   1998 |  272757369.06622
 UNITED KINGDOM            |   1997 | 462392955.525664
 UNITED KINGDOM            |   1996 | 461894096.570036
 UNITED KINGDOM            |   1995 | 457541797.633599
 UNITED KINGDOM            |   1994 | 460660612.950555
 UNITED KINGDOM            |   1993 | 457820544.763559
 UNITED KINGDOM            |   1992 | 468084106.588353
 UNITED STATES             |   1998 | 274962287.008194
 UNITED STATES             |   1997 | 480533976.899995
 UNITED STATES             |   1996 | 480698093.582122
 UNITED STATES             |   1995 | 475111583.615401
 UNITED STATES             |   1994 | 479905598.525411
 UNITED STATES             |   1993 | 483373626.827539
 UNITED STATES             |   1992 | 480354163.026934
 VIETNAM                   |   1998 | 267492654.184922
 VIETNAM                   |   1997 | 458853696.925862
 VIETNAM                   |   1996 | 464639985.007008
 VIETNAM                   |   1995 | 461098105.607539
 VIETNAM                   |   1994 | 462077570.553481
 VIETNAM                   |   1993 | 458828712.394441
 VIETNAM                   |   1992 | 466712817.010519
(175 rows)

COMMIT;
COMMIT
